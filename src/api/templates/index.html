<!-- src/api/templates/index.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –ø—Ä–æ–¥–∞–∂</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>üìä –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –æ–±—ä—ë–º–æ–≤ –ø—Ä–æ–¥–∞–∂</h1>
        <form id="predictForm">
            <label for="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–∞:</label>
            <input type="text" id="category" name="category" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: water_19l" required>

            <label for="date">–î–∞—Ç–∞ (–Ω–∞—á–∞–ª–æ –ø—Ä–æ–≥–Ω–æ–∑–∞):</label>
            <input type="date" id="date" name="date" required>

            <button type="submit">–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑ (Excel)</button>
        </form>
        <div id="status"></div>
    </div>

    <script>
        document.getElementById("predictForm").onsubmit = async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const params = new URLSearchParams(formData);

            const status = document.getElementById("status");
            status.innerText = "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–≥–Ω–æ–∑–∞...";

            const response = await fetch(`/predict/excel?${params}`);
            if (response.ok) {
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.download = `–ø—Ä–æ–≥–Ω–æ–∑_${formData.get("category")}.xlsx`;
                a.click();
                window.URL.revokeObjectURL(url);
                status.innerText = "‚úÖ –ì–æ—Ç–æ–≤–æ! –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω.";
            } else {
                status.innerText = "‚ùå –û—à–∏–±–∫–∞: " + await response.text();
            }
        };
    </script>
</body>
</html>